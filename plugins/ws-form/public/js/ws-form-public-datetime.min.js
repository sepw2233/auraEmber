!function(t){"use strict";t.WS_Form.prototype.form_date=function(){var e=t('[data-type="datetime"] input',this.form_canvas_obj);if(!e.length)return!1;if("off"==t.WS_Form.settings_plugin.ui_datepicker)return!1;if(this.form_date_datetimepicker_enabled())this.form_date_process();else if(this.native_date){var a=this;e.each(function(){var e=t(this).attr("value");if(""==e)return!1;var i=t(this).attr("data-date-type");try{switch(i){case"datetime-local":var r=a.get_new_date(e),s=new Date(r.valueOf()-6e4*r.getTimezoneOffset()).toISOString();e=s.substring(0,s.length-1)}}catch(t){a.error("error_datetime_default_value",t)}t(this).val(e)})}this.form_date_validity()},t.WS_Form.prototype.form_date_datetimepicker_enabled=function(){return"function"==typeof jQuery().datetimepicker&&"object"==typeof jQuery.datetimepicker&&"function"==typeof jQuery.datetimepicker.setLocale&&"function"==typeof jQuery.datetimepicker.setDateFormatter&&("on"==t.WS_Form.settings_plugin.ui_datepicker||"native"==t.WS_Form.settings_plugin.ui_datepicker&&!this.native_date)},t.WS_Form.prototype.form_date_process=function(e){var a=this;void 0===e&&(e=t('[data-type="datetime"] input',this.form_canvas_obj));var i=ws_form_settings.locale.substring(0,2);jQuery.datetimepicker.setLocale(i),e.each(function(){var e=a.get_field(t(this));if(t(this).is("[readonly]"))t(this).datetimepicker("destroy");else{var i=t(this).attr("id")+"-datetime-picker",r=t(this).attr("data-date-type"),s=t(this).attr("data-date-format")?t(this).attr("data-date-format"):ws_form_settings.date_format,d=t(this).attr("data-time-format")?t(this).attr("data-time-format"):ws_form_settings.time_format,_=t(this).attr("data-time-step")?parseInt(t(this).attr("data-time-step"),10):15;_<=0&&(_=15);var o={allowBlank:!0,formatDate:"Y-m-d",formatTime:d,id:i,scrollInput:!1,scrollMonth:!1,scrollTime:!1,timepickerScrollbar:!1,validateOnBlur:!1,rtl:ws_form_settings.rtl,className:"wsf-datetime-picker"},n=a.get_object_meta_value(e,"class_datetime_picker");n&&(o.className+=" "+n.trim()),a.get_object_meta_value(e,"parent_form")&&(o.parentID="#"+a.form_obj.attr("id")),void 0!==t(this).attr("data-inline")&&(o.inline=!0);var l=t(this).attr("data-dow-start")?parseInt(t(this).attr("data-dow-start"),10):1;if(l<0&&(l=0),l>6&&(l=6),o.dayOfWeekStart=l,f=t(this).attr("min-date"))if("+"!=f.charAt(0)&&"-"!=f.charAt(0)){var f,m=parseInt(ws_form_settings.gmt_offset,10);(f=a.get_new_date(f)).setHours(f.getHours()+-1*m),o.minDate=a.date_format(f,"Y-m-d")}else o.minDate=f;if(c=t(this).attr("max-date"))if("+"!=c.charAt(0)&&"-"!=c.charAt(0)){var c;m=parseInt(ws_form_settings.gmt_offset,10);(c=a.get_new_date(c)).setHours(c.getHours()+-1*m),o.maxDate=a.date_format(c,"Y-m-d")}else o.maxDate=c;var h=t(this).attr("min-time");h&&(o.minTime=h);var p=t(this).attr("max-time");p&&(o.maxTime=p);var v=t(this).attr("data-year-start");v&&(o.yearStart=v);var u=t(this).attr("data-year-end");switch(u&&(o.yearEnd=u),r){case"date":o.format=s,o.timepicker=!1,o.closeOnDateSelect=!0;break;case"time":o.format=d,o.datepicker=!1,o.step=_,o.closeOnDateSelect=!0;break;case"month":o.format="F Y",o.timepicker=!1,o.closeOnDateSelect=!0;break;case"week":var g="";a.language("week").split("").map(t=>{g+="\\"+t}),o.format=g+" W, Y",o.timepicker=!1,o.weeks=!0,o.closeOnDateSelect=!0;break;default:o.format=s+" "+d,o.step=_}a.conversational&&(o.onShow=function(e,a){var i=t(".xdsoft_datetimepicker").first();a.after(i)});var y=[],b=a.get_object_meta_value(e,"disabled_week_days");if("object"==typeof b&&b.length)for(var k in b)if(b.hasOwnProperty(k)){var w=b[k];void 0!==w.disabled_week_days_day&&(w=parseInt(w.disabled_week_days_day,10))>=0&&w<=6&&y.push(w)}y.length>0&&(o.disabledWeekDays=y);var j=[],D=a.get_object_meta_value(e,"disabled_dates");if("object"==typeof D&&D.length)for(var S in D)if(D.hasOwnProperty(S)){var O=D[S];void 0!==O.disabled_dates_date&&""!=O.disabled_dates_date&&j.push(O.disabled_dates_date)}j.length>0&&(o.disabledDates=j);var F=[],x=a.get_object_meta_value(e,"enabled_dates");if("object"==typeof x&&x.length)for(var W in x)if(x.hasOwnProperty(W)){var Y=x[W];void 0!==Y.enabled_dates_date&&""!=Y.enabled_dates_date&&F.push(Y.enabled_dates_date)}F.length>0&&(o.allowDates=F);var I=[],H=a.get_object_meta_value(e,"enabled_times");if("object"==typeof H&&H.length)for(var P in H)if(H.hasOwnProperty(P)){var Q=H[P];void 0!==Q.enabled_times_time&&""!=Q.enabled_times_time&&I.push(Q.enabled_times_time)}I.length>0&&(o.allowTimes=I),t(this).datetimepicker(o),t("#"+i).attr("data-wsf-style-id",a.form.meta.style_id)}})},t.WS_Form.prototype.form_date_validity=function(){if(void 0!==jQuery().datetimepicker){var e=this;t('input[type="text"][data-date-type]:not([data-hidden],[data-hidden-section],[data-hidden-group]), input[type="text"][data-date-type]:not([data-hidden],[data-hidden-section],[data-hidden-group])',this.form_canvas_obj).each(function(){e.field_date_validity_process(t(this)),t(this).on("change",function(){e.field_date_validity_process(t(this))})})}},t.WS_Form.prototype.field_date_validity_process=function(t){this.get_field_id(t);var e=this.get_field(t);if(this.set_invalid_feedback(t,""),""!==(r=t.val())){"function"==typeof this.field_date_translate&&(r=this.field_date_translate(r));var a=t.attr("data-date-type");switch(a){case"week":case"month":case"time":return}var i=t.attr("data-date-format")?t.attr("data-date-format"):ws_form_settings.date_format,r=this.get_date(r,a,i);if(this.date_valid(r)){var s=this.parse_date_min_max(t,"min-date"),d=this.parse_date_min_max(t,"max-date");if(s&&r<s||d&&r>d)this.set_invalid_feedback(t,!1);else{var _=this.get_object_meta_value(e,"disabled_week_days");if("object"==typeof _&&_.length)for(var o in _)if(_.hasOwnProperty(o)){var n=_[o];if(void 0!==n.disabled_week_days_day&&(n=parseInt(n.disabled_week_days_day,10))>=0&&n<=6&&r.getDay()===n)return void this.set_invalid_feedback(t,!1)}var l=this.get_object_meta_value(e,"disabled_dates");if("object"==typeof l&&l.length)for(var f in l){var m;if(l.hasOwnProperty(f))if(void 0!==(m=l[f]).disabled_dates_date)if(""!=m.disabled_dates_date)if((m=this.get_date(m.disabled_dates_date,"date","Y-m-d")).getFullYear()===r.getFullYear()&&m.getMonth()===r.getMonth()&&m.getDate()===r.getDate())return void this.set_invalid_feedback(t,!1)}var c=this.get_object_meta_value(e,"enabled_dates");if("object"==typeof c&&c.length){var h=!1,p=!1;for(var v in c){var u;if(c.hasOwnProperty(v))if(void 0!==(u=c[v]).enabled_dates_date)if(""!=u.enabled_dates_date)(u=this.get_date(u.enabled_dates_date,"date","Y-m-d")).getFullYear()===r.getFullYear()&&u.getMonth()===r.getMonth()&&u.getDate()===r.getDate()&&(h=!0),p=!0}if(p&&!h)return void this.set_invalid_feedback(t,!1)}}}else this.set_invalid_feedback(t,!1)}},t.WS_Form.prototype.parse_date_min_max=function(t,e){var a=t.attr(e);if(!a)return"";"function"==typeof this.field_date_translate&&(a=this.field_date_translate(a));var i=0,r=t.attr("data-date-type");switch(r){case"date":case"datetime-local":case"week":case"month":var s=a.substring(0,1);if("-"===s||"+"===s){var d=a.substring(1),_=this.get_new_date(d);if(!this.date_valid(_))return"";var o=(o=Math.floor(_/864e5))*("-"===s?-1:1);return(n=new Date).setHours(0,0,0,0),n.setDate(n.getDate()+o),n}}switch(r){case"date":a+=" 00:00:00";break;case"datetime-local":i=parseInt(ws_form_settings.gmt_offset,10);break;case"time":a="01/01/1970 "+a}var n=this.get_new_date(a);return this.date_valid(n)?(n.setHours(n.getHours()+-1*i),n):""}}(jQuery);